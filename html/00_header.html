<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pico AutoInput Editor v6</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<style>
    /* --- Base & Layout --- */
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; font-family: "Meiryo", sans-serif; background-color: #f0f0f0; overflow: hidden; }
    #container { display: flex; width: 100%; height: 100%; box-sizing: border-box; }
    
    /* --- Left Pane: Editor --- */
    #editor-pane { 
        width: 55%; 
        height: 100%;
        display: flex; 
        flex-direction: column; 
        background-color: #fff; 
        border-right: 1px solid #ccc;
    }
    
    /* Toolbar Area */
    #toolbar { 
        padding: 8px; 
        background: #eee; 
        border-bottom: 1px solid #ccc; 
        display: flex; 
        align-items: center; 
        gap: 10px; 
        flex-shrink: 0; 
    }
    .tool-btn { padding: 5px 12px; cursor: pointer; border: 1px solid #999; background: #fff; border-radius: 3px; font-size: 0.9rem; transition: background 0.1s;}
    .tool-btn:hover { background: #e6f7ff; border-color: #1890ff; }
    .toggle-label { font-size: 0.9rem; user-select: none; display: flex; align-items: center; gap: 5px; cursor: pointer; }
    
    #status-area { 
        padding: 4px 8px; 
        font-size: 0.85rem; 
        color: #333; 
        background: #fafafa;
        border-bottom: 1px solid #ddd;
        flex-shrink: 0; 
        white-space: nowrap; 
        overflow: hidden; 
        text-overflow: ellipsis; 
    }

    /* Editor Wrapper */
    #editor-wrapper {
        position: relative;
        flex-grow: 1;
        width: 100%;
        height: 0; /* Important for flex child to scroll */
        background-color: #fafafa;
        overflow: hidden;
    }

    /* Editor Layers */
    .editor-layer {
        position: absolute;
        top: 0; 
        left: 0;
        width: 100%; 
        height: 100%;
        padding: 10px;
        box-sizing: border-box;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre;
        overflow: auto;
        border: none;
        margin: 0;
    }

    #code-highlight {
        z-index: 1;
        color: transparent; 
        pointer-events: none; 
    }

    #code-input {
        z-index: 2;
        color: transparent; 
        background: transparent;
        caret-color: black; 
        outline: none;
        resize: none;
    }
    #code-input::selection { background: rgba(0, 120, 215, 0.3); color: transparent; }

    /* --- Syntax Highlighting --- */
    .line { display: block; min-height: 1.5em; }
    
    .func { color: #008000; font-weight: bold; } 
    .var  { color: #a52a2a; font-weight: bold; } 
    .arg  { color: #d4a017; }                    
    .other{ color: #0000ff; }                    
    .label-def, .label-ref { color: #a52a2a; font-weight: bold; text-decoration: underline; }

    /* Parenthesis Match Style */
    .paren-match { 
        border-bottom: 2px solid #008000; 
        background-color: rgba(0, 255, 0, 0.1);
    }

    /* Errors/Warnings */
    body.show-errors .error-bg { background-color: #ffcccc; }
    body.show-errors .warning-bg { background-color: #fff8c4; }
    
    .msg-text { font-size: 0.8em; font-weight: bold; margin-left: 10px; padding: 0 4px; border-radius: 2px; background: rgba(255,255,255,0.9); vertical-align: middle; }
    .err-text { color: red; display: none; }
    .warn-text { color: #e6a800; display: none; }

    body.show-errors .err-text { display: inline; }
    body.show-errors .warn-text { display: inline; }

    /* --- Autocomplete Popup --- */
    #autocomplete-list {
        position: absolute;
        border: 1px solid #ccc;
        background: #fff;
        z-index: 100;
        max-height: 200px;
        overflow-y: auto;
        box-shadow: 3px 3px 5px rgba(0,0,0,0.2);
        display: none;
        font-size: 12px;
        font-family: "Meiryo", sans-serif;
    }
    .ac-item { padding: 6px 10px; cursor: pointer; border-bottom: 1px solid #eee; }
    .ac-item:hover, .ac-item.selected { background-color: #e6f7ff; color: #1890ff; }
    .ac-match { font-weight: bold; color: #008000; }
    .ac-type { float: right; color: #888; font-size: 0.8em; margin-left: 10px; }

    /* --- Right Pane --- */
    #info-pane { 
        width: 45%; 
        height: 100%;
        display: flex; 
        flex-direction: column; 
        background-color: #f9f9f9; 
        border-left: 1px solid #ddd; 
    }
    
    .tab-bar { 
        display: flex; 
        background: #eee; 
        border-bottom: 1px solid #ccc; 
        flex-shrink: 0; 
    }
    .tab { padding: 10px 15px; cursor: pointer; border-right: 1px solid #ccc; background: #eee; font-size: 0.9rem; }
    .tab:hover { background: #ddd; }
    .tab.active { background: #fff; font-weight: bold; border-bottom: 1px solid #fff; margin-bottom: -1px; }
    
    .tab-content { display: none; flex-grow: 1; overflow-y: auto; padding: 15px; }
    .tab-content.active { display: block; }

    /* Reference Items */
    .doc-section { margin-bottom: 20px; }
    .doc-item { margin-bottom: 6px; padding: 6px; border-bottom: 1px solid #eee; cursor: pointer; background: #fff; border-radius: 4px; }
    .doc-item:hover { background-color: #e6f7ff; border-left: 4px solid #1890ff; padding-left: 2px; }
    .doc-syntax { font-family: monospace; font-weight: bold; color: #008000; background-color: #e8f5e9; padding: 2px 6px; border-radius: 3px; display: inline-block; margin-bottom: 2px;}
    .doc-desc { margin-left: 0px; font-size: 0.85rem; color: #555; line-height: 1.4; }
    
    h2 { font-size: 1.0rem; background: #eef; padding: 8px; border-left: 5px solid #0078d7; margin-top: 0; margin-bottom: 10px; border-radius: 2px; }
    
    /* Structure List */
    .struct-item { padding: 5px 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.9rem; background: #fff;}
    .struct-item:hover { background-color: #e0f7fa; }
    .struct-name { font-weight: bold; color: #001080; }

    /* Mermaid */
    #mermaid-container { text-align: center; padding: 10px; }

    /* --- Welcome Modal --- */
    #help-modal {
        display: none; 
        position: fixed; 
        z-index: 1000; 
        left: 0; top: 0; 
        width: 100%; height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.5);
        backdrop-filter: blur(2px);
    }
    .modal-content {
        background-color: #fff;
        margin: 5% auto; 
        padding: 0; 
        border: 1px solid #888;
        width: 80%; 
        max-width: 800px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        position: relative;
        animation: slidein 0.3s;
    }
    @keyframes slidein { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    .modal-header {
        padding: 15px 20px;
        background: #f5f5f5;
        border-bottom: 1px solid #ddd;
        border-radius: 8px 8px 0 0;
        display: flex; justify-content: space-between; align-items: center;
    }
    .modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; line-height: 1.6; color: #333; }
    .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close-btn:hover { color: #000; }
    
    .help-h3 { border-left: 4px solid #1890ff; padding-left: 10px; margin-top: 20px; background: #e6f7ff; padding: 5px 10px; font-size: 1.1em; font-weight: bold; }
    .help-key { background: #eee; padding: 2px 6px; border-radius: 4px; border: 1px solid #ccc; font-family: monospace; font-weight: bold; font-size: 0.9em; }
    .help-link { color: #1890ff; text-decoration: none; font-weight: bold; }
    .help-link:hover { text-decoration: underline; }

    /* Legend Colors */
    .legend-box { display: inline-block; width: 12px; height: 12px; margin-right: 5px; border-radius: 2px; vertical-align: middle; }
    .legend-func { background-color: #008000; }
    .legend-var { background-color: #a52a2a; }
    .legend-arg { background-color: #d4a017; }
    .legend-other { background-color: #0000ff; }

</style>
</head>
